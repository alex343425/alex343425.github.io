<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>篩選表格：隊長技+專武</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f7fa;
            --border-color: #ddd;
            --text-color: #333;
            --hover-color: #e6f7ff;
            --header-bg: #2c3e50;
            --header-text: #fff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            font-size: 14px;
        }

        /* 導覽列 */
        .nav-bar {
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .nav-bar a {
            text-decoration: none;
            color: var(--primary-color);
            padding: 5px 10px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            transition: all 0.3s;
        }

        .nav-bar a:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .nav-bar button#resetButton {
            margin-left: auto;
            background-color: #e74c3c;
            color: white;
            border: none;
        }

        .nav-bar button#resetButton:hover {
            background-color: #c0392b;
        }

        /* 篩選區塊容器 */
        .filter-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .filter-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: bold;
            color: #555;
        }

        /* 特殊佈局：Grid 用於大量 Checkbox */
        .grid-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 5px 10px;
            background: #fafafa;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #eee;
        }

        .grid-checkboxes label {
            font-weight: normal;
            font-size: 13px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .grid-checkboxes img {
            vertical-align: middle;
            margin-right: 4px;
        }

        /* 輸入框與按鈕美化 */
        input[type="text"], select {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }

        button {
            padding: 6px 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #357abd;
        }

        /* 關鍵字區域 */
        #keywordButtonsArea {
            margin-top: 10px;
            padding: 10px;
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            border-radius: 4px;
        }

        .keywordBtn {
            background-color: white;
            color: #d48806;
            border: 1px solid #d48806;
            margin: 3px;
            font-size: 12px;
            padding: 2px 8px;
        }
        
        .keywordBtn:hover {
            background-color: #fff1b8;
        }

        /* 表格樣式 */
        .table-wrapper {
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th, td {
            padding: 10px;
            border: 1px solid var(--border-color);
            text-align: left;
            vertical-align: middle;
        }

        th {
            background-color: var(--header-bg);
            color: var(--header-text);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background-color: var(--hover-color);
        }

        /* 固定寬度類別 */
        .fixed-width { width: 4em; text-align: center; }

        /* 特殊高亮 (原 lswep 保留) */
        .highlight1 { background-color: AliceBlue; }
        .highlight2 { background-color: MistyRose; }
        
        /* 關鍵字高亮 (原 lswep 腳本生成) */
        span[class^="highlight"] {
            font-weight: bold;
            padding: 0 2px; 
            border-radius: 2px;
        }
        span.highlight1 { background-color: #fff700; color: black; }
        span.highlight2 { background-color: #87ceeb; color: black; }
        span.highlight3 { background-color: #90ee90; color: black; }

        /* 分頁按鈕樣式 */
        #pagination, #paginationTop {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        #pagination button, #paginationTop button {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
        }

        #pagination button:disabled, #paginationTop button:disabled {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            cursor: default;
        }

        /* 圖片 */
        td img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }

        /* ---------------- Modal 樣式 (新增) ---------------- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.6); 
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto; /* 距離頂部一些距離，並置中 */
            padding: 20px;
            border: 1px solid #888;
            width: 90%; 
            max-width: 1000px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            max-height: 90vh; /* 避免超過視窗高度 */
            display: flex;
            flex-direction: column;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 10px;
            cursor: pointer;
            z-index: 1001;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
            align-items: flex-start;
        }

        .modal-header-img {
            flex-shrink: 0;
        }

        .modal-header-info {
            flex-grow: 1;
        }

        .modal-header-info h2 {
            margin: 0 0 10px 0;
            color: var(--primary-color);
        }

        .tag {
            display: inline-block;
            background: #eee;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            color: #555;
            border: 1px solid #ccc;
        }

        .wiki-link-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 5px 15px;
            background-color: #8e44ad;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .wiki-link-btn:hover {
            background-color: #732d91;
        }

        /* Modal 內容滾動區 */
        .modal-body {
            overflow-y: auto;
            flex-grow: 1;
        }

        .section-title {
            background-color: #2c3e50;
            color: white;
            padding: 8px 15px;
            margin-top: 20px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-weight: bold;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        .modal-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .modal-table th {
            background-color: #e9ecef;
            color: #333;
            border: 1px solid #ddd;
            padding: 8px;
            position: static; /* Modal 內不固定表頭以免遮擋 */
        }

        .modal-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        
        /* 連結樣式，用於觸發 Modal */
        .char-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }
        .char-link:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        let currentPage = 1;
        const pageSize = 300; // 每頁顯示數量，可自行調整
        let currentFilteredData = [];

        document.addEventListener("DOMContentLoaded", function () {
            let searchMode = 'original';

            // Modal 元素
            const modal = document.getElementById("charModal");
            const span = document.getElementsByClassName("close")[0];

            // 關閉 Modal 的事件
            span.onclick = function() {
                modal.style.display = "none";
            }
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

            function loadData() {
                fetch('data_leader_wep.json')
                .then(response => response.json())
                .then(data => {
                    currentFilteredData = data; // 初始化數據
                    renderTable(data, 1);
                    
                    document.getElementById('ctFilter').addEventListener('change', () => filterData(data));
                    document.getElementById('buff_cancel_rate').addEventListener('change', () => filterData(data));
                    document.getElementById('em_resist').addEventListener('change', () => filterData(data));
                    document.getElementById('img_show').addEventListener('change', () => filterData(data));
                    document.getElementById('searchButton').addEventListener('click', () => filterData(data));
                    
                    document.querySelectorAll('.char-em-filter').forEach(checkbox => {
                        checkbox.addEventListener('change', () => filterData(data));
                    });
                    document.querySelectorAll('.char-wep-filter').forEach(checkbox => {
                        checkbox.addEventListener('change', () => filterData(data));
                    });
                    document.querySelectorAll('.skill-type-filter').forEach(checkbox => {
                        checkbox.addEventListener('change', () => filterData(data));
                    });
                    document.querySelectorAll('.skill-state-filter').forEach(checkbox => {
                        checkbox.addEventListener('change', () => filterData(data));
                    });
                    document.querySelectorAll('.char_source_filter').forEach(checkbox => {
                        checkbox.addEventListener('change', () => filterData(data));
                    });

                    document.getElementById('modeOriginal').addEventListener('click', function () { searchMode = 'original'; });
                    document.getElementById('modeSequential').addEventListener('click', function () { searchMode = 'sequential'; });
                    document.getElementById('modeStrictSequential').addEventListener('click', function () { searchMode = 'strictSequential'; });

                    document.querySelector("#descriptionFilter").addEventListener("keyup", function(event) {
                        if (event.keyCode === 13) {
                            event.preventDefault();
                            filterData(data);
                        }
                    });

                    document.querySelector("#toggleKeywordButtons").addEventListener("click", function() {
                        const keywordArea = document.querySelector("#keywordButtonsArea");
                        if (keywordArea.style.display === "none") {
                            keywordArea.style.display = "block";
                            this.innerText = "收起常用關鍵字";
                        } else {
                            keywordArea.style.display = "none";
                            this.innerText = "展開常用關鍵字";
                        }
                    });

                    document.querySelectorAll(".keywordBtn").forEach(button => {
                        button.addEventListener("click", function() {
                            const keyword = this.getAttribute("data-keyword");
                            const currentInput = document.querySelector("#descriptionFilter").value.trim();
                            if (currentInput && !currentInput.endsWith(keyword)) {
                                document.querySelector("#descriptionFilter").value = currentInput + " " + keyword;
                            } else if (!currentInput) {
                                document.querySelector("#descriptionFilter").value = keyword;
                            }
                        });
                    });
                    
                    document.querySelectorAll('input[name="searchMode"]').forEach(radio => {
                        radio.addEventListener('change', function () {
                            searchMode = this.value;
                        });
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
            }

            document.getElementById('resetButton').addEventListener('click', function () {
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                document.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0;
                });
                document.getElementById('descriptionFilter').value = '';
                loadData();
            });

            function highlightKeywords(text, keywords) {
                if (!keywords || keywords.length === 0 || keywords[0] === "") return text;
                keywords.forEach((keyword, index) => {
                    let regex = new RegExp(keyword, "gi");
                    text = text.replace(regex, `<span class="highlight${index + 1}">$&</span>`);
                });
                return text;
            }

            // 將 openCharModal 暴露到全域
            window.openCharModal = function(index) {
                const item = currentFilteredData[index];
                if (!item) return;

                const modalHeader = document.getElementById("modalHeader");
                const modalBody = document.getElementById("modalBody");
                const modal = document.getElementById("charModal");

                // 1. 設置 Header
                let imgHtml = item.img_name ? `<img src="img/${item.img_name}" alt="${item.skill_char}" height="100" style="border-radius:8px;" onerror="this.src='img/0.png';">` : '';
                let wikiLink = `https://otogi.wikiru.jp/index.php?${item.skill_char}`;
                
                modalHeader.innerHTML = `
                    <div class="modal-header-img">${imgHtml}</div>
                    <div class="modal-header-info">
                        <h2>${item.skill_char}</h2>
                        <div>
                            <span class="tag">屬性: ${item.char_em}</span>
                            <span class="tag">武器: ${item.char_wep}</span>
                            <span class="tag">${item.sp_sort || '無分類'}</span>
                        </div>
                        <a href="${wikiLink}" target="_blank" class="wiki-link-btn">前往 Wiki 頁面</a>
                    </div>
                `;

                // 2. 顯示 Modal 並顯示載入中
                modalBody.innerHTML = '<p>載入資料中...</p>';
                modal.style.display = "block";

                // 3. 讀取 JSON
                let jsonFileName = item.img_name.split('.')[0] + '.json';
                
                fetch(`./charjson/${jsonFileName}`)
                    .then(res => {
                        if (!res.ok) throw new Error('Network response was not ok');
                        return res.json();
                    })
                    .then(charData => {
                        renderModalTables(charData);
                    })
                    .catch(err => {
                        console.error("Fetch error:", err);
                        modalBody.innerHTML = '<p style="color:red;">找不到該角色的詳細資料檔 (JSON)。</p>';
                    });
            };

            function renderModalTables(data) {
                const modalBody = document.getElementById("modalBody");
                let html = '';

                // Helper function to create table rows
                const createTable = (items, headers, rowMapper) => {
                    if (!items || items.length === 0) return '<p>無資料</p>';
                    
                    let thead = headers.map(h => `<th>${h}</th>`).join('');
                    let tbody = items.map(rowMapper).join('');
                    
                    return `
                        <table class="modal-table">
                            <thead><tr>${thead}</tr></thead>
                            <tbody>${tbody}</tbody>
                        </table>
                    `;
                };

                // 1. Skill 表格
                if (data.skill && data.skill.length > 0) {
                    html += '<div class="section-title">固有技能 (Skills)</div>';
                    html += createTable(
                        data.skill, 
                        ['技能名', '種類', '狀態', '描述'], 
                        s => `<tr>
                                <td style="width:20%">${s.skill_name}</td>
                                <td style="width:10%; text-align:center;">${s.skill_type}</td>
                                <td style="width:10%; text-align:center;">${s.skill_state}</td>
                                <td>${s.description}</td>
                            </tr>`
                    );
                }

                // 2. LS 表格
                if (data.ls && data.ls.length > 0) {
                    html += '<div class="section-title">隊長技能 (Leader Skills)</div>';
                    html += createTable(
                        data.ls, 
                        ['技能名', '描述'], 
                        l => `<tr>
                                <td style="width:25%">${l.skill_name}</td>
                                <td>${l.description}</td>
                            </tr>`
                    );
                }

                // 3. Wep 表格
                if (data.wep && data.wep.length > 0) {
                    html += '<div class="section-title">專武技能 (Weapon Skills)</div>';
                    html += createTable(
                        data.wep, 
                        ['技能名', '描述'], 
                        w => `<tr>
                                <td style="width:25%">${w.skill_name}</td>
                                <td>${w.description}</td>
                            </tr>`
                    );
                }

                // 4. Acc 表格
                if (data.acc && data.acc.length > 0) {
                    html += '<div class="section-title">飾品 (Accessories)</div>';
                    html += createTable(
                        data.acc, 
                        ['名稱', '描述'], 
                        a => `<tr>
                                <td style="width:25%">${a.skill_name}</td>
                                <td>${a.description}</td>
                            </tr>`
                    );
                }

                if (html === '') html = '<p>此檔案中沒有技能資料。</p>';
                modalBody.innerHTML = html;
            }

            // 暴露給全域以便按鈕調用
            window.pageChange = function(page) {
                currentPage = page;
                renderTable(currentFilteredData, currentPage);
            }

            function renderPagination(totalItems, currentPage) {
                const paginationTop = document.getElementById('paginationTop');
                const paginationBottom = document.getElementById('pagination');
                
                paginationTop.innerHTML = '';
                paginationBottom.innerHTML = '';

                if (totalItems <= pageSize) {
                    return; 
                }

                const totalPages = Math.ceil(totalItems / pageSize);

                function createPaginationButtons(container) {
                    // 上一頁
                    if (currentPage > 1) {
                        const prevBtn = document.createElement('button');
                        prevBtn.textContent = '上一頁';
                        prevBtn.onclick = () => window.pageChange(currentPage - 1);
                        container.appendChild(prevBtn);
                    }

                    // 頁碼 (簡單版)
                    let startPage = Math.max(1, currentPage - 3);
                    let endPage = Math.min(totalPages, currentPage + 3);
                    
                    if (startPage > 1) {
                         const firstBtn = document.createElement('button');
                         firstBtn.textContent = '1';
                         firstBtn.onclick = () => window.pageChange(1);
                         container.appendChild(firstBtn);
                         if (startPage > 2) {
                             const dots = document.createElement('span');
                             dots.textContent = '...';
                             dots.style.padding = '5px';
                             container.appendChild(dots);
                         }
                    }

                    for (let i = startPage; i <= endPage; i++) {
                        const pageBtn = document.createElement('button');
                        pageBtn.textContent = i;
                        if (i === currentPage) {
                            pageBtn.disabled = true;
                        } else {
                            pageBtn.onclick = () => window.pageChange(i);
                        }
                        container.appendChild(pageBtn);
                    }
                    
                    if (endPage < totalPages) {
                        if (endPage < totalPages - 1) {
                             const dots = document.createElement('span');
                             dots.textContent = '...';
                             dots.style.padding = '5px';
                             container.appendChild(dots);
                        }
                        const lastBtn = document.createElement('button');
                        lastBtn.textContent = totalPages;
                        lastBtn.onclick = () => window.pageChange(totalPages);
                        container.appendChild(lastBtn);
                    }

                    // 下一頁
                    if (currentPage < totalPages) {
                        const nextBtn = document.createElement('button');
                        nextBtn.textContent = '下一頁';
                        nextBtn.onclick = () => window.pageChange(currentPage + 1);
                        container.appendChild(nextBtn);
                    }
                }

                createPaginationButtons(paginationTop);
                createPaginationButtons(paginationBottom);
            }

            function renderTable(data, page = 1) {
                let tableBody = document.getElementById('tableBody');
                let img_showValue = document.getElementById('img_show').checked ? 1 : 0;
                tableBody.innerHTML = '';

                // 分頁計算
                let start = (page - 1) * pageSize;
                let end = start + pageSize;
                let pageData = data.slice(start, end);

                // 改用 forEach 以便獲取 index 來計算 globalIndex
                pageData.forEach((item, index) => {
                    let globalIndex = start + index;
                    let tr = document.createElement('tr');
                    
                    if (item.type === "專武技能") {
                        tr.classList.add("highlight1");
                    } else if (item.type === "角色飾品") {
                        tr.classList.add("highlight2");
                    }
                    
                    let additionalInfo = item.sp_sort ? `<br>${item.sp_sort}` : '';
                    
                    // 修改：點擊圖片觸發 Modal
                    let img_show_data = img_showValue ? `
                        <a href="javascript:void(0)" class="char-link" onclick="openCharModal(${globalIndex})">
                            <img src="img/${item.img_name}" alt="${item.skill_char}" height="70" onerror="this.src='img/0.png';">
                        </a><br>` : '';
                    
                    // 修改：點擊名稱觸發 Modal
                    let imgCellContent = item.img_name ? `
                        ${img_show_data}
                        <a href="javascript:void(0)" class="char-link" onclick="openCharModal(${globalIndex})">${item.skill_char}</a>
                        ${additionalInfo}` : '--';
                    
                    tr.innerHTML = `
                        <td>${item.skill_name}</td>
                        <td class="fixed-width">${item.type}</td>
                        <td>${imgCellContent}</td>
                        <td class="fixed-width">${item.char_em}</td>
                        <td class="fixed-width">${item.char_wep}</td>
                        <td class="description-column">${item.description}</td>
                    `;
                    
                    tableBody.appendChild(tr);
                });

                // 渲染分頁按鈕
                renderPagination(data.length, page);

                // 處理關鍵字高亮 (針對當前頁面)
                let descriptionKeyword = document.getElementById('descriptionFilter').value;
                if (descriptionKeyword) {
                    let keywords = descriptionKeyword.split(' ');
                    let descCells = tableBody.querySelectorAll('.description-column');
                    descCells.forEach(cell => {
                        cell.innerHTML = highlightKeywords(cell.innerHTML, keywords);
                    });
                }
            }

            function filterData(data) {
                let ctValue = parseInt(document.getElementById('ctFilter').value);
                let buff_cancel_rateValue = parseInt(document.getElementById('buff_cancel_rate').value);            
                let em_resistValue = parseInt(document.getElementById('em_resist').value);
                let descriptionKeyword = document.getElementById('descriptionFilter').value;
                
                // Get selected checkboxes
                let selectedCharEm = Array.from(document.querySelectorAll('.char-em-filter:checked')).map(cb => cb.value);
                let selectedCharWep = Array.from(document.querySelectorAll('.char-wep-filter:checked')).map(cb => cb.value);
                let selectedSkillType = [];
                document.querySelectorAll('.skill-type-filter:checked').forEach(checkbox => {
                    selectedSkillType.push(...checkbox.value.split(','));
                });
                let selectedCharSource = Array.from(document.querySelectorAll('.char_source_filter:checked')).map(cb => parseInt(cb.value));

                let filteredData = data.filter(item => {
                    let keywords = descriptionKeyword.split(' ');
                    let matchesDescription = false;
                    
                    // 描述搜尋邏輯
                    if (!descriptionKeyword) {
                        matchesDescription = true;
                    } else {
                        switch (searchMode) {
                        case 'original':
                            matchesDescription = keywords.every(keyword =>
                                    item.description.includes(keyword) || item.skill_name.includes(keyword));
                            break;
                        case 'sequential':
                            let combinedKeywords = keywords.join('.*');
                            let regex = new RegExp(combinedKeywords);
                            matchesDescription = regex.test(item.description);
                            break;
                        case 'strictSequential':
                            let combinedKeywords2 = keywords.join('[^、。・]*');
                            let regex2 = new RegExp(combinedKeywords2);
                            matchesDescription = regex2.test(item.description);
                            break;
                        }
                    }

                    let matchesCt = ctValue == 0 || item.permanent_skill_up >= ctValue;
                    let matchesdebuff = buff_cancel_rateValue == 0 || item.debuff >= buff_cancel_rateValue;
                    let matchesCharSource = selectedCharSource.length === 0 || selectedCharSource.includes(item.sp_sort_for_search);
                    let matchesem_resist = em_resistValue == 0 || item.enchant >= em_resistValue;
                    let matchesCharEm =  item.char_em === '全' || selectedCharEm.length === 0 || selectedCharEm.includes(item.char_em);
                    let matchesCharWep = selectedCharWep.length === 0 || selectedCharWep.includes(item.char_wep);
                    let matchesSkillType = selectedSkillType.length === 0 || selectedSkillType.includes(item.type);
                    
                    return matchesCt && matchesdebuff && matchesem_resist && matchesDescription && matchesCharEm && matchesCharWep && matchesSkillType && matchesCharSource;
                });

                // 更新全域數據並重置頁碼
                currentFilteredData = filteredData;
                currentPage = 1;
                renderTable(currentFilteredData, currentPage);
            }

            loadData();
        });
    </script>
</head>

<body>
    
    <div class="nav-bar">
        <a href="./index.html" target="_blank">技能搜尋</a>
        <a href="./lswep.html" target="_blank">隊長技/專武搜尋</a>
        <a href="./cheerleading.html" target="_blank">啦啦隊搜尋</a>
        <a href="./normal_char.html" target="_blank">普池收集檢查</a>
        <a href="./profiles.html" target="_blank">親愛度文本</a>
		<a href="./exp_party.html" target="_blank">最佳經驗隊</a>		
		<a href="./loot_party.html" target="_blank">最佳複製隊</a>
        <button id="resetButton">重置所有篩選</button>
    </div>

    <div class="filter-container">
        
        <div class="filter-row">
            <div class="filter-group" style="flex: 2;">
                <label for="descriptionFilter">描述過濾:</label>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="descriptionFilter" placeholder="輸入過濾關鍵字 (空白分隔)..." style="width: 100%;">
                    <button id="searchButton">搜尋</button>
                </div>
            </div>
            
            <div class="filter-group" style="flex: 1;">
                <label>描述搜尋模式:</label>
                <div>
                    <label><input type="radio" name="searchMode" value="original" id="modeOriginal" checked> 原始</label>
                    <label><input type="radio" name="searchMode" value="sequential" id="modeSequential"> 前到後</label>
                    <label><input type="radio" name="searchMode" value="strictSequential" id="modeStrictSequential"> 前到後且不分句</label>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div style="width: 100%;">
                <button id="toggleKeywordButtons">展開常用關鍵字</button>
                <div id="keywordButtonsArea" style="display: none;">
                    <strong>常用指令：</strong><br>
                    <button class="keywordBtn" data-keyword="デバフムーブ">debuff move</button>
                    <button class="keywordBtn" data-keyword="ディスペルバリア">藍果凍(防打消盾)</button>
                    <button class="keywordBtn" data-keyword="ドレインバリア">紅果凍(防偷BUFF盾)</button>
                    <button class="keywordBtn" data-keyword="バフドレイン">偷Buff</button>
                    <br>
                    <button class="keywordBtn" data-keyword="ぬすん">偷竊複製</button>
                    <button class="keywordBtn" data-keyword="ドロップ率">打寶力</button>
                    <button class="keywordBtn" data-keyword="クエスト アイテム">掉落複製</button>
                    <button class="keywordBtn" data-keyword="プレイヤー経験">玩家經驗</button>
                    <br>
                    <button class="keywordBtn" data-keyword="全覚醒">全覺醒(僅限1次拆技昇華)</button>
                    <button class="keywordBtn" data-keyword="超覚醒">超覺醒(每回合拆技昇華)</button>
                    <hr>
                    <strong>異常賦予：</strong><br>
                    <button class="keywordBtn" data-keyword="毒">毒(5%)</button>
                    <button class="keywordBtn" data-keyword="猛毒">猛毒(10%)</button>
                    <button class="keywordBtn" data-keyword="劇毒">劇毒(15%)</button>
                    <button class="keywordBtn" data-keyword="爆毒">爆毒(20%)</button>
                    <button class="keywordBtn" data-keyword="どくりんご">蘋果毒(30% 3回合)</button>
                    <button class="keywordBtn" data-keyword="どくりんご改">蘋果毒改(35% 3回合)</button>
                    <button class="keywordBtn" data-keyword="ピュルテバウンド">看板毒(30% 5回合)(技能名)</button>
                    <br>
                    <button class="keywordBtn" data-keyword="麻痺">麻痺</button>
                    <button class="keywordBtn" data-keyword="金縛り">金縛(80%不能行動)</button>
                    <button class="keywordBtn" data-keyword="びびりんご">麻蘋果(85%)</button>
                    <button class="keywordBtn" data-keyword="びびりんご改">麻蘋果改(88%)</button>
                    <br>
                    <button class="keywordBtn" data-keyword="幻惑">幻惑</button>
                    <button class="keywordBtn" data-keyword="幻覚">幻覚</button>
                    <button class="keywordBtn" data-keyword="悩殺">悩殺(5回合60%物理MISS)</button>
                    <br>
                    <button class="keywordBtn" data-keyword="スタン">暈眩(1回無法行動)</button>
                    <button class="keywordBtn" data-keyword="失神">失神(2回無法行動)</button>
                    <br>
                    <button class="keywordBtn" data-keyword="眠り">睡眠</button>
                    <button class="keywordBtn" data-keyword="昏睡">昏睡</button>
                    <button class="keywordBtn" data-keyword="ねむりんご">睡蘋果(被打10次才會醒)</button>
                    <button class="keywordBtn" data-keyword="超昏睡">超昏睡(被打15次才會醒)</button>
                    <button class="keywordBtn" data-keyword="ねむりんご改">睡蘋果改(被打15次才會醒)</button>
                    <br>
                    <button class="keywordBtn" data-keyword="混乱">混亂</button>
                    <button class="keywordBtn" data-keyword="呪い">詛咒</button>
                    <button class="keywordBtn" data-keyword="封印">封印</button>
                    <hr>
                    <strong>星宮解預兆 (配合 前到後且同句 模式)：</strong><br>
                    <button class="keywordBtn" data-keyword="攻撃 回 アップ">攻擊多回UP</button>
                    <button class="keywordBtn" data-keyword="防御 回 アップ">防禦多回UP</button>
                    <button class="keywordBtn" data-keyword="攻撃魔力 回 アップ">攻魔多回UP</button>
                    <button class="keywordBtn" data-keyword="すばやさ 回 アップ">速度(すばやさ)多回UP</button>
                    <button class="keywordBtn" data-keyword="HP 回 アップ">HP多回UP</button>
                    <button class="keywordBtn" data-keyword="全パラ 回 アップ">全能力多回UP (可能不含HP)</button>
                    <br>
                    <button class="keywordBtn" data-keyword="攻撃 回 ダウン">攻擊多回下降</button>
                    <button class="keywordBtn" data-keyword="防御 回 ダウン">防禦多回下降</button>
                    <button class="keywordBtn" data-keyword="攻撃魔力 回 ダウン">攻魔多回下降</button>
                    <button class="keywordBtn" data-keyword="すばやさ 回 ダウン">速度(すばやさ)多回下降</button>
                    <br>
                    <button class="keywordBtn" data-keyword="状態異常耐性 回 アップ">異常耐性多回UP</button>
                    <button class="keywordBtn" data-keyword="状態異常耐性 回 ダウン">異常耐性多回下降</button>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-group">
                <label for="ctFilter">永續昇華:</label>
                <select id="ctFilter">
                    <option value="0" selected>無</option>
                    <option value="1">有</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="buff_cancel_rate">Debuff突破:</label>
                <select id="buff_cancel_rate">
                    <option value="0" selected>無</option>
                    <option value="1">有</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="em_resist">エンチャント(普攻/技能觸發特效):</label>
                <select id="em_resist">
                    <option value="0" selected>無</option>
                    <option value="1">有</option>
                </select>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-group" style="flex: 1;">
                <label>Skill Type (種類):</label>
                <div class="grid-checkboxes">
                    <label><input type="checkbox" value="隊長技能" class="skill-type-filter">隊長技能</label>
                    <label><input type="checkbox" value="專武技能" class="skill-type-filter">專武技能</label>
                    <label><input type="checkbox" value="角色飾品" class="skill-type-filter">角色飾品</label>
                </div>
            </div>
            <div class="filter-group" style="flex: 2;">
                <label>角色來源分類:</label>
                <div class="grid-checkboxes">
                    <label><input type="checkbox" value="1" class="char_source_filter">普池角</label>
                    <label><input type="checkbox" value="4" class="char_source_filter">一般限定角</label>
                    <label><input type="checkbox" value="2" class="char_source_filter">合作角</label>
                    <label><input type="checkbox" value="3" class="char_source_filter">活動角</label>
                    <label><input type="checkbox" value="5" class="char_source_filter">其他/3-4星</label>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-group" style="flex: 1;">
                <label>角色屬性:</label>
                <div class="grid-checkboxes">
                    <label><input type="checkbox" value="火" class="char-em-filter"><img src="icon/00_01_04_03_i_ele_f.png" width="20" />火</label>
                    <label><input type="checkbox" value="水" class="char-em-filter"><img src="icon/00_01_04_03_i_ele_w.png" width="20" />水</label>
                    <label><input type="checkbox" value="樹" class="char-em-filter"><img src="icon/00_01_04_03_i_ele_r.png" width="20" />樹</label>
                    <label><input type="checkbox" value="光" class="char-em-filter"><img src="icon/00_01_04_03_i_ele_l.png" width="20" />光</label>
                    <label><input type="checkbox" value="闇" class="char-em-filter"><img src="icon/00_01_04_03_i_ele_d.png" width="20" />闇</label>
                </div>
            </div>
            <div class="filter-group" style="flex: 2;">
                <label>武器種類:</label>
                <div class="grid-checkboxes">
                    <label><input type="checkbox" value="剣" class="char-wep-filter"><img src="icon/kokuin_weaponsword.png" />劍</label>
                    <label><input type="checkbox" value="斧" class="char-wep-filter"><img src="icon/kokuin_weaponaxe.png" />斧</label>
                    <label><input type="checkbox" value="槍" class="char-wep-filter"><img src="icon/kokuin_weaponspear.png" />槍</label>
                    <label><input type="checkbox" value="本" class="char-wep-filter"><img src="icon/kokuin_weaponbook.png" />本</label>
                    <label><input type="checkbox" value="短剣" class="char-wep-filter"><img src="icon/kokuin_weaponshortsword.png" />短劍</label>
                    <label><input type="checkbox" value="杖" class="char-wep-filter"><img src="icon/kokuin_weaponthue.png" />杖</label>
                    <label><input type="checkbox" value="弓" class="char-wep-filter"><img src="icon/kokuin_weaponbow.png" />弓</label>
                    <label><input type="checkbox" value="特殊" class="char-wep-filter"><img src="icon/kokuin_weapontokushu.png" />特殊</label>
                </div>
            </div>
        </div>
        
        <div class="filter-row">
            <div class="filter-group">
                <label for="img_show" style="cursor: pointer; display: flex; align-items: center;">
                    <input type="checkbox" id="img_show" checked style="margin-right: 8px;"> 顯示圖片 <small style="color: #666; margin-left: 5px; font-weight: normal;">(若未篩選時，直接顯示圖片，可能導致載入過慢)</small>
                </label>
            </div>
        </div>

    </div>

    <div id="paginationTop"></div>

    <div class="table-wrapper">
        <table border="0">
            <thead>
                <tr>
                    <th>技能名</th>
                    <th class="fixed-width">種類</th>
                    <th>角色</th>
                    <th class="fixed-width">屬性</th>
                    <th class="fixed-width">武器</th>
                    <th>技能描述</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>

    <div id="pagination"></div>

    <div id="charModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalHeader" class="modal-header">
                </div>
            <div id="modalBody" class="modal-body">
                </div>
        </div>
    </div>

</body>
</html>